/**
* jQuery SimpleFliud v 0.8
* A dynamic layout plugin for jQuery
* @Link http://www.owent.net
* @Author OWenT
*
* Licensed under the MIT.
* Copyright 2013 OWenT
*/

(function(f,d){var j=[],g={};(function(){var a=["log","warn","info","error"];for(i=0;i<a.length;++i)f.console&&f.console[a[i]]?g[a[i]]=function(b){f.console[a[i]](b)}:(g[a[i]]=function(b){var a={};a[this.cmd_name]=b;j.push(a)},g[a[i]].cmd_name=a[i])})();var k=function(a,b,c){return(new function(b,a,c){var d=0,f=this;this.time_proc=function(){setTimeout(function(){Date.now()-d<a?f.time_proc():(d=0,c())},parseInt(a/10))};b.bind("resize",function(){Date.now()-d>=a&&(d=Date.now(),f.time_proc())})}(a,
b,c)).time_proc},h=function(a){a&&a.container_style&&(a.container_style=d.extend(this.SimpleFliud.options.container_style,a.container_style));a.wrapper=a.wrapper?a.wrapper:a.container;this._init(a)};h.prototype={options:{resize_duration:300,duration:500,panel_width:null,margin_cols:5,margin_row:5,container:null,wrapper:null,panel:"div",auto_width:!1,action_type:"immediately",animation_easing:"swing",container_style:{position:"relative"},event_onchange:function(){},event_afterchange:function(){}},
container:null,wrapper:null,panels:[],maxYs:[],cols_num:0,panel_wrapper:function(a,b){var c=d(a);c.change(function(){b()});return c},_init:function(a){var b=this,c=this.options=this.options=d.extend(this.options,a);b.container=d(c.container);b.wrapper=c.wrapper==c.container?b.container:d(c.wrapper);if(!c.panel_width||isNaN(c.panel_width))c.panel_width=d(c.panel,b.container).filter(":first").outerWidth(!0);var e=k(d(f),c.resize_duration,function(){c.event_onchange(b);b._reloadContainer(c.event_afterchange)});
d.each(d(c.panel,b.container),function(){b.panels.push(b.panel_wrapper(this,e))});b.container.css({position:c.container_style.position});for(a=0;a<b.panels.length;++a)b.panels[a].css({position:"absolute"});c.event_onchange(b);b._reloadContainer(c.event_afterchange)},_setContainerWidth:function(a,b){this.container.width()!=a&&(this.wrapper!=this.container?this._action(this.options.action_type).container.width(a,b):b&&"function"==typeof b&&b())},_calcColumns:function(a){return Math.min(this.cols_num,
Math.ceil((a-this.options.panel_width)/(this.options.panel_width+this.options.margin_row))+1)},_calcWidth:function(a){return a*this.options.panel_width+(a-1)*this.options.margin_cols},_reloadContainer:function(a){var b=this;b.cols_num=Math.floor((b.wrapper.innerWidth()-b.options.panel_width)/(b.options.panel_width+b.options.margin_row)+1);var c=b._calcWidth(b.cols_num);b._setContainerWidth(c,function(){b._reloadPanels(a);b._action(b.options.action_type).container.height(Math.max.apply(Math,b.maxYs.slice(0,
b.maxYs.length))-b.options.margin_row)})},_setPanelPosition:function(a,b,c){this.options.auto_width&&a.width(this._calcWidth(b.ce-b.c));for(var e=b.c;e<b.ce;++e)this.maxYs[e]=b.y+this.options.margin_row+a.outerHeight();this._action(this.options.action_type).panel.position(a,{left:b.c*(this.options.margin_cols+this.options.panel_width),top:b.y},c);c&&"function"==typeof c&&c()},_reloadPanels:function(a){var b=this;b.maxYs=[];for(var c=b.cols_num;c--;)b.maxYs.push(0);var e=0;d.each(b.panels,function(){var c=
b._calcColumns(this.outerWidth()),d=b._getPosition(c);d.ce=c=d.c+c;b._setPanelPosition(this,d,function(){e++;e==b.panels.length&&(a&&"function"==typeof a)&&a()})})},_getPosition:function(a){if(a==this.cols_num)return{c:0,y:Math.max.apply(Math,this.maxYs)};for(var b=0,c=Math.max.apply(Math,this.maxYs.slice(0,a)),e=0;e+a<=this.cols_num;++e){var d=Math.max.apply(Math,this.maxYs.slice(e,e+a));d<c&&(b=e,c=d)}return{c:b,y:c}},_action:function(a){var b=this;return{immediately:{container:{width:function(a,
e){e=e||function(){};b.container.width(a);e()},height:function(a,e){e=e||function(){};b.container.height(a);e()}},panel:{position:function(b,a,d){d=d||function(){};b.css({left:a.left,top:a.top});d()}}},animation:{container:{width:function(a,e){e=e||function(){};b.container.stop().animate({width:a},b.options.duration,b.options.animation_easing,function(){e()})},height:function(a,e){e=e||function(){};b.container.stop().animate({height:a},b.options.duration,b.options.animation_easing,function(){e()})}},
panel:{position:function(a,e,d){d=d||function(){};a.stop().animate({left:e.left,top:e.top},b.options.duration,b.options.animation_easing,function(){d()});d()}}}}[a]}};d.SimpleFliud=function(a){return new h(a)};d.fn.SimpleFliud=function(a){a.container=this.selector;d.SimpleFliud(a)}})(window,jQuery);
